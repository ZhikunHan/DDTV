(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{391:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"websocket服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket服务器"}},[t._v("#")]),t._v(" WebSocket服务器")]),t._v(" "),a("h2",{attrs:{id:"怎么启用websocket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么启用websocket"}},[t._v("#")]),t._v(" 怎么启用WebSocket")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("DDTVLiveRec.xxx.config")]),t._v("文件中，配置以下几个项目:")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("WebSocketEnable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 是否使能WebSocket服务器 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("WebSocketPort"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("11451"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- WebSocket服务器初始化时使用的端口号 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("WebSocketUserName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 用于获取Token的WebSocket服务器账号 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("WebSocketPassword"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 用于获取Token的WebSocket服务器密码 --\x3e")]),t._v("\n")])])]),a("h2",{attrs:{id:"websocket的数据包封装格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket的数据包封装格式"}},[t._v("#")]),t._v(" WebSocket的数据包封装格式")]),t._v(" "),a("p",[t._v("服务器对于往返的数据包都套用相同的外壳，如客户端发送给服务器的数据格式均为:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//命令码")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Token"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxxxxxxxxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//用于验证身份的Token")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messge"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//具体的命令交互内容")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("其中Messge的内容应该为Json字符串，而不是Json对象"),a("br"),t._v("\n如:请求Token的完整命令应为:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Token"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messge"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"UserName\\":\\"defaultUserName\\",\\"Password\\":\\"defaultPassword\\"}"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),a("p",[t._v("此文档中的所有命令都只标注messge内容，外壳请自行添加")])]),t._v(" "),a("p",[t._v("服务器发送给客户端的外壳数据封装格式和API请求返回的信息格式一致，具体内容请参照"),a("a",{attrs:{href:"../API"}},[t._v("API请求")])]),t._v(" "),a("h2",{attrs:{id:"目前会响应的请求命令码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目前会响应的请求命令码"}},[t._v("#")]),t._v(" 目前会响应的请求命令码")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("功能")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("命令码")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("请求WebSocketWToken")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2001")])]),t._v(" "),a("tr",[a("td",[t._v("获取系统运行情况")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2002")])]),t._v(" "),a("tr",[a("td",[t._v("查看当前配置文件")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2003")])]),t._v(" "),a("tr",[a("td",[t._v("检查更新")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2004")])]),t._v(" "),a("tr",[a("td",[t._v("获取系统运行日志")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2005")])]),t._v(" "),a("tr",[a("td",[t._v("获取当前录制中的队列简报")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2006")])]),t._v(" "),a("tr",[a("td",[t._v("获取所有下载任务的队列简报")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2007")])]),t._v(" "),a("tr",[a("td",[t._v("根据录制任务GUID获取任务详情")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2008")])]),t._v(" "),a("tr",[a("td",[t._v("根据录制任务GUID取消相应任务")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2009")])]),t._v(" "),a("tr",[a("td",[t._v("增加配置文件中监听的房间")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2010")])]),t._v(" "),a("tr",[a("td",[t._v("删除配置文件中监听的房间")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2011")])]),t._v(" "),a("tr",[a("td",[t._v("修改房间的自动录制开关配置")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2012")])]),t._v(" "),a("tr",[a("td",[t._v("获取当前房间配置列表总览")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2013")])]),t._v(" "),a("tr",[a("td",[t._v("获取当前录制文件夹中的所有文件的列表")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2014")])]),t._v(" "),a("tr",[a("td",[t._v("删除某个录制完成的文件")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2015")])]),t._v(" "),a("tr",[a("td",[t._v("根据房间号获得相关录制文件")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2016")])]),t._v(" "),a("tr",[a("td",[t._v("获取上传任务信息列表")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2017")])]),t._v(" "),a("tr",[a("td",[t._v("获取上传中的任务信息列表")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2018")])])])]),t._v(" "),a("h2",{attrs:{id:"websocket服务器的工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websocket服务器的工作流程"}},[t._v("#")]),t._v(" WebSocket服务器的工作流程")]),t._v(" "),a("p",[t._v("WebSocket功能在使用具体命令前，需向DDTV发送2001命令，以获取Token")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"UserName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Password"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"password"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("其他所有的操作均和"),a("a",{attrs:{href:"../API"}},[t._v("API请求")]),t._v("一致，区别只是WebSocket服务器公共接口为code、Token和messge，其中messge为私有属性，无其他值，私有属性定义和API一致")])])])}),[],!1,null,null,null);s.default=n.exports}}]);